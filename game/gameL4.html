<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lesson 4: Medial Short /a/ Sound</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Fredoka', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }

    .phone-container {
      max-width: 400px;
      margin: 0 auto;
      background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .game-container {
      background: white;
      border-radius: 30px 30px 0 0;
      box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.2);
      padding: 30px 20px 20px;
      flex: 1;
      margin-top: 80px;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .title {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
      font-size: 1.75rem;
      text-align: center;
      margin-bottom: 8px;
    }

    .subtitle {
      text-align: center;
      color: #6b7280;
      font-size: 0.9rem;
      margin-bottom: 20px;
      font-weight: 500;
    }

    .progress-container {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border-radius: 20px;
      padding: 15px;
      text-align: center;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
    }

    .progress-label {
      color: white;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .progress-value {
      color: white;
      font-size: 2rem;
      font-weight: 700;
    }

    .progress-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.4);
      transition: all 0.3s ease;
    }

    .dot.completed {
      background: white;
      box-shadow: 0 2px 8px rgba(255, 255, 255, 0.6);
    }

    .dot.current {
      background: white;
      transform: scale(1.4);
      box-shadow: 0 2px 8px rgba(255, 255, 255, 0.8);
    }

    .image-box {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 24px;
      padding: 40px 20px;
      text-align: center;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.2);
      transition: all 0.3s ease;
    }

    .image-box:hover {
      transform: scale(1.02);
      box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4);
    }

    .emoji {
      font-size: 100px;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    .message-box {
      background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%);
      border-radius: 20px;
      padding: 16px;
      text-align: center;
      font-size: 1rem;
      font-weight: 600;
      color: #5b21b6;
      margin-bottom: 20px;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(139, 92, 246, 0.2);
    }

    .buttons-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 15px;
    }

    .answer-button {
      font-size: 1.5rem;
      font-weight: 700;
      padding: 20px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
      width: 100%;
      font-family: 'Fredoka', sans-serif;
    }

    .answer-button:hover:not(:disabled) {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }

    .answer-button:active:not(:disabled) {
      transform: translateY(-2px);
    }

    .answer-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .button-option-1 {
      background: linear-gradient(135deg, #fde047 0%, #fb923c 100%);
      color: #1f2937;
      border: 3px solid #facc15;
    }

    .button-option-2 {
      background: linear-gradient(135deg, #86efac 0%, #5eead4 100%);
      color: #1f2937;
      border: 3px solid #22c55e;
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% {
        opacity: 0.2;
        transform: scale(1);
      }
      50% {
        opacity: 1;
        transform: scale(1.2);
      }
    }

    .celebration {
      position: fixed;
      font-size: 3rem;
      pointer-events: none;
      animation: celebrate 1s ease-out;
      z-index: 1000;
    }

    @keyframes celebrate {
      0% {
        transform: translateY(0) scale(0);
        opacity: 1;
      }
      100% {
        transform: translateY(-100px) scale(1.5);
        opacity: 0;
      }
    }

    .header-section {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 24px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 10;
    }

    .back-btn {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 2px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
      text-decoration: none;
      color: white;
      font-size: 1.5rem;
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    .header-title-mobile {
      color: white;
      font-size: 1.25rem;
      font-weight: 700;
      flex: 1;
      text-align: center;
      margin: 0 12px;
    }

    .result-container {
      text-align: center;
      padding: 20px 0;
    }

    .result-emoji {
      font-size: 80px;
      margin-bottom: 20px;
      animation: celebrate-result 0.6s ease;
    }

    @keyframes celebrate-result {
      0%, 100% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.2) rotate(-10deg); }
      75% { transform: scale(1.2) rotate(10deg); }
    }

    .result-title {
      font-size: 2rem;
      color: #9333ea;
      font-weight: 700;
      margin-bottom: 20px;
    }

    .result-score-box {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
    }

    .result-score-label {
      color: white;
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .result-score {
      color: white;
      font-size: 3rem;
      font-weight: 700;
    }

    .play-again-button {
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      color: white;
      font-size: 1.3rem;
      font-weight: 700;
      padding: 18px 40px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
      transition: all 0.3s ease;
      font-family: 'Fredoka', sans-serif;
      width: 100%;
    }

    .play-again-button:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
    }

    .confetti-piece {
      position: fixed;
      width: 10px;
      height: 10px;
      z-index: 1000;
      animation: confetti-fall 3s linear forwards;
    }

    @keyframes confetti-fall {
      to { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <div class="phone-container">
    <!-- Background Stars -->
    <div id="stars"></div>

    <!-- Header -->
    <div class="header-section">
      <a href="../Users/dashboard.html" class="back-btn">‚Üê</a>
      <div class="header-title-mobile">üìö Medial /a/ Sound</div>
      <div style="width: 48px;"></div>
    </div>

    <div class="game-container" id="gameContainer">
      <!-- Content will be rendered here -->
    </div>
  </div>

  <script>
    // Questions with medial short /a/ sound
    // Add your MP3 files in the format: sounds/cat.mp3, sounds/hat.mp3, etc.
    const questions = [
      { image: 'üê±', correct: 'cat', wrong: 'cot', sound: '/c/ - /a/ - /t/', correctAudio: 'sounds/cat.mp3', wrongAudio: 'sounds/cot.mp3' },
      { image: 'üé©', correct: 'hat', wrong: 'hit', sound: '/h/ - /a/ - /t/', correctAudio: 'sounds/hat.mp3', wrongAudio: 'sounds/hit.mp3' },
      { image: 'üêÄ', correct: 'rat', wrong: 'rot', sound: '/r/ - /a/ - /t/', correctAudio: 'sounds/rat.mp3', wrongAudio: 'sounds/rot.mp3' },
      { image: 'ü¶á', correct: 'bat', wrong: 'bit', sound: '/b/ - /a/ - /t/', correctAudio: 'sounds/bat.mp3', wrongAudio: 'sounds/bit.mp3' },
      { image: 'üó∫Ô∏è', correct: 'map', wrong: 'mop', sound: '/m/ - /a/ - /p/', correctAudio: 'sounds/map.mp3', wrongAudio: 'sounds/mop.mp3' },
      { image: 'üß¢', correct: 'cap', wrong: 'cup', sound: '/c/ - /a/ - /p/', correctAudio: 'sounds/cap.mp3', wrongAudio: 'sounds/cup.mp3' },
      { image: 'üöï', correct: 'cab', wrong: 'cub', sound: '/c/ - /a/ - /b/', correctAudio: 'sounds/cab.mp3', wrongAudio: 'sounds/cub.mp3' },
      { image: 'üêú', correct: 'ant', wrong: 'end', sound: '/a/ - /n/ - /t/', correctAudio: 'sounds/ant.mp3', wrongAudio: 'sounds/end.mp3' }
    ];

    let currentAudio = null;

    function playSound(audioFile) {
      // Stop any currently playing audio
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }
      
      // Play the new audio
      currentAudio = new Audio(audioFile);
      currentAudio.play().catch(err => {
        console.error('Audio playback failed:', err);
      });
    }

    let currentQ = 0;
    let score = 0;
    let totalTries = 0;
    let showResult = false;
    let hasAnswered = false;

    const starsContainer = document.getElementById('stars');
    const gameContainer = document.getElementById('gameContainer');

    // Create background stars
    for (let i = 0; i < 30; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      const size = Math.random() * 3 + 1;
      star.style.width = size + 'px';
      star.style.height = size + 'px';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 60 + '%';
      star.style.animationDelay = Math.random() * 3 + 's';
      star.style.animationDuration = (Math.random() * 2 + 2) + 's';
      starsContainer.appendChild(star);
    }

    function celebrate() {
      const emojis = ['üéâ', '‚≠ê', 'üåü', '‚ú®', 'üéä', 'üèÜ'];
      for (let i = 0; i < 6; i++) {
        setTimeout(() => {
          const celebration = document.createElement('div');
          celebration.className = 'celebration';
          celebration.textContent = emojis[Math.floor(Math.random() * emojis.length)];
          celebration.style.left = Math.random() * window.innerWidth + 'px';
          celebration.style.top = Math.random() * window.innerHeight + 'px';
          document.body.appendChild(celebration);
          setTimeout(() => celebration.remove(), 1000);
        }, i * 100);
      }
    }

    function createConfetti() {
      const colors = ['#fbbf24', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b'];
      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti-piece';
          confetti.style.left = Math.random() * window.innerWidth + 'px';
          confetti.style.top = '-10px';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDelay = Math.random() * 0.5 + 's';
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 3000);
        }, i * 30);
      }
    }

    function renderGame() {
      hasAnswered = false;
      gameContainer.innerHTML = `
        <h1 class="title">üìö Medial Short /a/ Sound</h1>
        <p class="subtitle">Listen to both words first, then choose the one with /a/!</p>

        <div class="progress-container">
          <div class="progress-label">Your Score</div>
          <div class="progress-value">${score} / ${totalTries}</div>
          <div class="progress-dots">
            ${questions.map((_, i) => `
              <div class="dot ${i < currentQ ? 'completed' : ''} ${i === currentQ ? 'current' : ''}"></div>
            `).join('')}
          </div>
        </div>

        <div class="image-box" style="cursor: pointer;" id="emojiBox">
          <div class="emoji">${questions[currentQ].image}</div>
        </div>

        <div class="message-box" id="message">
          üîä Click a button to hear the word, then click again to choose!
        </div>

        <div class="buttons-container">
          <button class="answer-button button-option-1" id="btn1">
            ${questions[currentQ].correct}
          </button>
          <button class="answer-button button-option-2" id="btn2">
            ${questions[currentQ].wrong}
          </button>
        </div>
      `;

      // Click emoji to hear correct answer
      document.getElementById('emojiBox').addEventListener('click', function() {
        playSound(questions[currentQ].correctAudio);
        this.style.transform = 'scale(1.1)';
        setTimeout(() => { this.style.transform = 'scale(1)'; }, 300);
      });

      // Play sound and handle answer on same button click
      let btn1Clicked = false;
      let btn2Clicked = false;

      document.getElementById('btn1').addEventListener('click', function() {
        if (!hasAnswered) {
          if (!btn1Clicked) {
            // First click: play sound
            playSound(questions[currentQ].correctAudio);
            btn1Clicked = true;
            this.style.transform = 'scale(1.05)';
            setTimeout(() => { this.style.transform = 'scale(1)'; }, 200);
          } else {
            // Second click: submit answer
            handleAnswer(questions[currentQ].correct);
          }
        }
      });

      document.getElementById('btn2').addEventListener('click', function() {
        if (!hasAnswered) {
          if (!btn2Clicked) {
            // First click: play sound
            playSound(questions[currentQ].wrongAudio);
            btn2Clicked = true;
            this.style.transform = 'scale(1.05)';
            setTimeout(() => { this.style.transform = 'scale(1)'; }, 200);
          } else {
            // Second click: submit answer
            handleAnswer(questions[currentQ].wrong);
          }
        }
      });
    }

    function renderResult() {
      const percentage = Math.round((score / totalTries) * 100);
      let emoji = 'üéâ';
      let title = 'Amazing Work!';
      
      if (percentage === 100) {
        emoji = 'üèÜ';
        title = 'Perfect Score!';
      } else if (percentage >= 80) {
        emoji = '‚≠ê';
        title = 'Excellent Job!';
      } else if (percentage >= 60) {
        emoji = 'üëç';
        title = 'Good Effort!';
      } else {
        emoji = 'üí™';
        title = 'Keep Practicing!';
      }

      gameContainer.innerHTML = `
        <div class="result-container">
          <div class="result-emoji">${emoji}</div>
          <div class="result-title">${title}</div>
          
          <div class="result-score-box">
            <div class="result-score-label">Final Score</div>
            <div class="result-score">${score} / ${totalTries}</div>
          </div>

          <div style="background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%); border-radius: 20px; padding: 16px; margin-bottom: 20px;">
            <div style="color: #5b21b6; font-weight: 600; font-size: 0.95rem;">
              üéØ Accuracy: ${percentage}%
            </div>
          </div>

          <button class="play-again-button" onclick="restartGame()">
            üîÑ Try Again
          </button>
        </div>
      `;

      createConfetti();
      
      // Save game completion to localStorage
      localStorage.setItem("readingGameCompleted", "true");
      
      // Redirect to dashboard after 5 seconds
      setTimeout(() => {
        window.location.href = '../Users/dashboard.html';
      }, 5000);
    }

    function handleAnswer(selected) {
      if (hasAnswered) return;
      hasAnswered = true;

      const buttons = document.querySelectorAll('.answer-button');
      buttons.forEach(btn => btn.disabled = true);

      totalTries++;
      const isCorrect = selected === questions[currentQ].correct;
      const messageEl = document.getElementById('message');

      if (isCorrect) {
        score++;
        messageEl.innerHTML = `‚ú® Correct! "${questions[currentQ].correct}" has the /a/ sound!`;
        messageEl.style.background = 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)';
        messageEl.style.color = '#065f46';
        celebrate();
      } else {
        messageEl.innerHTML = `üí´ Not quite! The correct word is "${questions[currentQ].correct}"`;
        messageEl.style.background = 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)';
        messageEl.style.color = '#991b1b';
      }

      setTimeout(() => {
        if (currentQ < questions.length - 1) {
          currentQ++;
          renderGame();
        } else {
          showResult = true;
          renderResult();
        }
      }, 2000);
    }

    function restartGame() {
      currentQ = 0;
      score = 0;
      totalTries = 0;
      showResult = false;
      renderGame();
    }

    // Initialize
    renderGame();
  </script>
</body>
</html>